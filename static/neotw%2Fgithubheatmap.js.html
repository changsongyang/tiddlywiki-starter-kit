<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="generator" content="TiddlyWiki" />
<meta name="tiddlywiki-version" content="5.2.5" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="format-detection" content="telephone=no">
<link id="faviconLink" rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="static.css">
<title>neotw/githubheatmap.js:  Neotw 🎉
 — A modern notebook based on TiddlyWiki5
</title>
</head>
<body class="tc-body">

<section class="tc-story-river tc-static-story-river">
<p><div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists " data-tags="" data-tiddler-title="neotw/githubheatmap.js" role="article">







  
  <div class="gk0wk-notionpagebg gk0wk-notionpagebg-n">
    <div class="gk0wk-notionbg-addbuttons">
      <button class="" title="Add Cover"><svg class="tc-image-picture tc-image-button" height="22pt" viewBox="0 0 128 128" width="22pt"><path d="M112 68.233v-48.23A4.001 4.001 0 00107.997 16H20.003A4.001 4.001 0 0016 20.003v38.31l9.241-14.593c2.8-4.422 9.023-5.008 12.6-1.186l18.247 20.613 13.687-6.407a8 8 0 018.903 1.492 264.97 264.97 0 002.92 2.739 249.44 249.44 0 006.798 6.066 166.5 166.5 0 002.106 1.778c2.108 1.747 3.967 3.188 5.482 4.237.748.518 1.383.92 2.044 1.33.444.117 1.046.144 1.809.05 1.873-.233 4.238-1.144 6.723-2.547a36.016 36.016 0 003.205-2.044c.558-.4.93-.686 1.07-.802.376-.31.765-.577 1.165-.806zM0 8.007A8.01 8.01 0 018.007 0h111.986A8.01 8.01 0 01128 8.007v111.986a8.01 8.01 0 01-8.007 8.007H8.007A8.01 8.01 0 010 119.993V8.007zM95 42a8 8 0 100-16 8 8 0 000 16zM32 76c15.859 4.83 20.035 7.244 20.035 12S32 95.471 32 102.347c0 6.876 1.285 4.99 1.285 9.653H68s-13.685-6.625-13.685-10.8c0-7.665 10.615-8.34 10.615-13.2 0-7.357-14.078-8.833-32.93-12z" fill-rule="evenodd"></path></svg> Add Cover</button>
    </div>
  </div>









<div class="tc-tiddler-title"><div class="tc-titlebar"><span class="tc-tiddler-controls"><button aria-label="trashbin" class="tc-btn-invisible tc-btn-%24%3A%2Fplugins%2Fkookma%2Ftrashbin%2Fui%2Ftoolbar-button" title="Move this tiddler to Trashbin"> 
















</button><button aria-expanded="false" aria-label="more" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fmore-tiddler-actions" title="More actions"></button><div class=" tc-reveal" hidden="true"></div><button aria-label="favorites" class="tc-btn-invisible tc-btn-%24%3A%2Fplugins%2Fkookma%2Ffavorites%2Fui%2Fbuttons%2Fadd-remove" title="Add to favorites">
     
		 

		 
 </button><button aria-label="close others" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fclose-others" title="Close other tiddlers"></button><span class=" tc-reveal"><button aria-label="fold tiddler" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Ffold" title="Fold the body of this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><button aria-label="edit" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fedit" title="Edit this tiddler"></button><button class="tc-btn-invisible tc-btn-%24%3A%2Fplugins%2Foeyoews%2Fneotw%2Fui%2Fcopy-code" title="copy current code"></button><button class="tc-btn-invisible tc-btn-%24%3A%2Fplugins%2Foeyoews%2Fneotw%2Fui%2Fcopy-title" title="copy current title"></button><button aria-label="close" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fclose" title="Close this tiddler"></button></span><a class="tc-tiddlylink tc-tiddlylink-resolves" href="neotw%252Fgithubheatmap.js.html"><h2 class="tc-title">neotw/githubheatmap.js</h2></a></div><div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div></div><div class="tc-reveal"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">





<label class="tc-checkbox "><input type="checkbox"><span></span></label>



<select title="status" value="public">
&lt;/$set&gt;
  <option value="private">private</option>
  <option value="no">hide</option>
  <option value="public">public</option>
</select>

</div>
</div>
<div class="tc-tags-wrapper">
  
  
</div>




<div class="tc-tiddler-body tc-reveal"><pre class="hljs"><code class="javascript hljs"><span class="hljs-comment">/* Written by Gk0Wk(https://github.com/Gk0Wk) */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getFilterByDate</span> = (<span class="hljs-params">date, subfilter</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-string">`[all[tiddlers]<span class="hljs-subst">${subfilter}</span>sameday:created[<span class="hljs-subst">${date}</span>]][all[tiddlers]<span class="hljs-subst">${subfilter}</span>sameday:modified[<span class="hljs-subst">${date}</span>]]+[sort[]]`</span>;
};
<span class="hljs-keyword">const</span> yearDates = {};
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getData</span> = (<span class="hljs-params">year, subfilter</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!yearDates[year]) {
    <span class="hljs-keyword">const</span> startDate = +echarts.<span class="hljs-property">number</span>.<span class="hljs-title function_">parseDate</span>(<span class="hljs-string">`<span class="hljs-subst">${year}</span>-01-01`</span>);
    <span class="hljs-keyword">const</span> endDate = +echarts.<span class="hljs-property">number</span>.<span class="hljs-title function_">parseDate</span>(<span class="hljs-string">`<span class="hljs-subst">${year + <span class="hljs-number">1</span>}</span>-01-01`</span>);
    <span class="hljs-keyword">const</span> dayTime = <span class="hljs-number">3600</span> * <span class="hljs-number">24</span> * <span class="hljs-number">1000</span>;
    <span class="hljs-keyword">const</span> dates = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> time = startDate; time &lt; endDate; time += dayTime) {
      <span class="hljs-keyword">const</span> timeFmt = echarts.<span class="hljs-property">format</span>.<span class="hljs-title function_">formatTime</span>(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>, time);
      <span class="hljs-keyword">const</span> timeTW = timeFmt.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/-/g</span>, <span class="hljs-string">&quot;&quot;</span>);
      dates.<span class="hljs-title function_">push</span>([timeFmt, timeTW]);
    }
    yearDates[year] = dates;
  }
  <span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">return</span> [
    yearDates[year].<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[timeFmt, timeTW]</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> count = $tw.<span class="hljs-property">wiki</span>.<span class="hljs-title function_">filterTiddlers</span>(<span class="hljs-title function_">getFilterByDate</span>(timeTW, subfilter)).<span class="hljs-property">length</span>;
      total += count;
      <span class="hljs-keyword">return</span> [timeFmt, count];
    }),
    total,
  ];
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getPlatteColor</span> = (<span class="hljs-params">name</span>) =&gt;
  $tw.<span class="hljs-property">wiki</span>.<span class="hljs-title function_">renderText</span>(
    <span class="hljs-string">&quot;text/plain&quot;</span>,
    <span class="hljs-string">&quot;text/vnd.tiddlywiki&quot;</span>,
    <span class="hljs-string">`&lt;$transclude tiddler={{$:/palette}} index=&quot;<span class="hljs-subst">${name}</span>&quot;&gt;&lt;$transclude tiddler=&quot;$:/palettes/Vanilla&quot; index=&quot;<span class="hljs-subst">${name}</span>&quot;&gt;&lt;$transclude tiddler=&quot;$:/config/DefaultColourMappings/<span class="hljs-subst">${name}</span>&quot;/&gt;&lt;/$transclude&gt;&lt;/$transclude&gt;`</span>,
    {}
  );

<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkIfChinese</span> = (<span class="hljs-params"></span>) =&gt;
  $tw.<span class="hljs-property">wiki</span>.<span class="hljs-title function_">getTiddlerText</span>(<span class="hljs-string">&quot;$:/language&quot;</span>).<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;zh&quot;</span>) !== -<span class="hljs-number">1</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkIfDarkMode</span> = (<span class="hljs-params"></span>) =&gt;
  $tw.<span class="hljs-property">wiki</span>.<span class="hljs-title function_">getTiddler</span>($tw.<span class="hljs-property">wiki</span>.<span class="hljs-title function_">getTiddlerText</span>(<span class="hljs-string">&quot;$:/palette&quot;</span>)).<span class="hljs-property">fields</span>[
    <span class="hljs-string">&quot;color-scheme&quot;</span>
  ] === <span class="hljs-string">&quot;dark&quot;</span>;

<span class="hljs-built_in">exports</span>.<span class="hljs-property">onMount</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> {};
};

<span class="hljs-built_in">exports</span>.<span class="hljs-property">shouldUpdate</span> = <span class="hljs-function">(<span class="hljs-params">_, changedTiddlers</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> $tw.<span class="hljs-property">utils</span>.<span class="hljs-title function_">count</span>(changedTiddlers) &gt; <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">tooltipFormatter</span> = (<span class="hljs-params">subfilter</span>) =&gt; <span class="hljs-function">(<span class="hljs-params">{ value }</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> [dateValue, count] = value;
    <span class="hljs-keyword">if</span> (count === <span class="hljs-number">0</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">checkIfChinese</span>()
        ? <span class="hljs-string">`<span class="hljs-subst">${echarts.format.formatTime(<span class="hljs-string">&quot;yyyy年M月d日&quot;</span>, dateValue)}</span> 无条目。`</span>
        : <span class="hljs-string">`<span class="hljs-subst">${$tw.utils.formatDateString(
            $tw.utils.parseDate(dateValue.replace(/-/g, <span class="hljs-string">&quot;&quot;</span>)),
            <span class="hljs-string">&quot;MMM DDD, YYYY&quot;</span>
          )}</span> no tiddler.`</span>;
    <span class="hljs-keyword">const</span> p = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;p&quot;</span>);
    p.<span class="hljs-property">innerText</span> = <span class="hljs-title function_">checkIfChinese</span>()
      ? <span class="hljs-string">`<span class="hljs-subst">${echarts.format.formatTime(
          <span class="hljs-string">&quot;yyyy年M月d日&quot;</span>,
          dateValue
        )}</span> 共有 <span class="hljs-subst">${count}</span> 篇:`</span>
      : <span class="hljs-string">`<span class="hljs-subst">${$tw.utils.formatDateString(
          $tw.utils.parseDate(dateValue.replace(/-/g, <span class="hljs-string">&quot;&quot;</span>)),
          <span class="hljs-string">&quot;MMM DDD, YYYY&quot;</span>
        )}</span> <span class="hljs-subst">${count}</span> tiddler<span class="hljs-subst">${count &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">&quot;s&quot;</span> : <span class="hljs-string">&quot;&quot;</span>}</span>.`</span>;
    <span class="hljs-keyword">const</span> ul = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;ul&quot;</span>);
    <span class="hljs-keyword">const</span> tiddlers = $tw.<span class="hljs-property">wiki</span>.<span class="hljs-title function_">filterTiddlers</span>(
      <span class="hljs-title function_">getFilterByDate</span>(dateValue.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/-/g</span>, <span class="hljs-string">&quot;&quot;</span>), subfilter)
    );
    <span class="hljs-keyword">const</span> len = tiddlers.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) {
      <span class="hljs-keyword">const</span> tiddler = tiddlers[i];
      <span class="hljs-keyword">const</span> li = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;li&quot;</span>);
      <span class="hljs-keyword">const</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;a&quot;</span>);
      a.<span class="hljs-property">innerText</span> = tiddler;
      a.<span class="hljs-property">className</span> =
        <span class="hljs-string">&quot;tc-tiddlylink tc-tiddlylink-resolves tc-popup-handle tc-popup-absolute&quot;</span>;
      a.<span class="hljs-property">style</span>.<span class="hljs-property">cursor</span> = <span class="hljs-string">&quot;pointer&quot;</span>;
      a.<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> $tw.<span class="hljs-title class_">Story</span>().<span class="hljs-title function_">navigateTiddler</span>(tiddler);
      li.<span class="hljs-title function_">appendChild</span>(a);
      ul.<span class="hljs-title function_">appendChild</span>(li);
    }
    <span class="hljs-keyword">return</span> [p, ul];
  };

<span class="hljs-built_in">exports</span>.<span class="hljs-property">onUpdate</span> = <span class="hljs-function">(<span class="hljs-params">myChart, _state, addonAttributes</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> year = <span class="hljs-built_in">parseInt</span>(addonAttributes.<span class="hljs-property">year</span>, <span class="hljs-number">10</span>) || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getFullYear</span>();
  <span class="hljs-keyword">const</span> subfilter = addonAttributes.<span class="hljs-property">subfilter</span> || <span class="hljs-string">&#x27;!is[shadow]!prefix[$:/]&#x27;</span>;
  <span class="hljs-keyword">const</span> [data, total] = <span class="hljs-title function_">getData</span>(year, subfilter);
  myChart.<span class="hljs-title function_">setOption</span>({
    <span class="hljs-attr">title</span>: {
      <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">left</span>: <span class="hljs-string">&quot;center&quot;</span>,
      <span class="hljs-attr">text</span>: <span class="hljs-title function_">checkIfChinese</span>()
        ? <span class="hljs-string">`今年产出 <span class="hljs-subst">${total}</span> 篇文章`</span>
        : <span class="hljs-string">`Produced <span class="hljs-subst">${total}</span> tiddlers this year`</span>,
    },
    <span class="hljs-attr">tooltip</span>: {
      <span class="hljs-attr">position</span>: <span class="hljs-string">&quot;top&quot;</span>,
      <span class="hljs-attr">formatter</span>: <span class="hljs-title function_">tooltipFormatter</span>(subfilter),
      <span class="hljs-attr">triggerOn</span>: <span class="hljs-string">&quot;mousemove|click&quot;</span>,
      <span class="hljs-attr">enterable</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">hideDelay</span>: <span class="hljs-number">400</span>,
      <span class="hljs-attr">backgroundColor</span>: <span class="hljs-title function_">getPlatteColor</span>(<span class="hljs-string">&quot;page-background&quot;</span>),
      <span class="hljs-attr">borderColor</span>: <span class="hljs-title function_">getPlatteColor</span>(<span class="hljs-string">&quot;very-muted-foreground&quot;</span>),
    },
    <span class="hljs-attr">visualMap</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;piecewise&quot;</span>,
      <span class="hljs-attr">orient</span>: <span class="hljs-string">&quot;horizontal&quot;</span>,
      <span class="hljs-attr">calculable</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">showLabel</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">right</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">top</span>: <span class="hljs-number">175</span>,
      <span class="hljs-attr">pieces</span>: [
        <span class="hljs-comment">// 设置分段范围</span>
        { <span class="hljs-attr">lte</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">color</span>: <span class="hljs-title function_">checkIfDarkMode</span>() ? <span class="hljs-string">&quot;#161B22&quot;</span> : <span class="hljs-string">&quot;#EBEDF0&quot;</span> },
        { <span class="hljs-attr">gt</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">lte</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;#0E4429&quot;</span> },
        { <span class="hljs-attr">gt</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">lte</span>: <span class="hljs-number">7</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;#006D32&quot;</span> },
        { <span class="hljs-attr">gt</span>: <span class="hljs-number">7</span>, <span class="hljs-attr">lte</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;#26A641&quot;</span> },
        { <span class="hljs-attr">gt</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;#39D353&quot;</span> },
      ],
    },
    <span class="hljs-attr">calendar</span>: {
      <span class="hljs-attr">top</span>: <span class="hljs-number">60</span>,
      <span class="hljs-attr">cellSize</span>: <span class="hljs-number">15</span>,
      <span class="hljs-attr">orient</span>: <span class="hljs-string">&quot;horizontal&quot;</span>,
      <span class="hljs-attr">range</span>: year,
      <span class="hljs-attr">itemStyle</span>: {
        <span class="hljs-attr">borderWidth</span>: <span class="hljs-number">3</span>,
        <span class="hljs-attr">borderCap</span>: <span class="hljs-string">&quot;round&quot;</span>,
        <span class="hljs-attr">borderJoin</span>: <span class="hljs-string">&quot;round&quot;</span>,
        <span class="hljs-attr">borderColor</span>: <span class="hljs-title function_">getPlatteColor</span>(<span class="hljs-string">&quot;background&quot;</span>),
      },
      <span class="hljs-attr">splitLine</span>: {
        <span class="hljs-attr">show</span>: <span class="hljs-literal">false</span>,
      },
      <span class="hljs-attr">dayLabel</span>: {
        <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">nameMap</span>: <span class="hljs-title function_">checkIfChinese</span>() ? <span class="hljs-string">&quot;ZH&quot;</span> : <span class="hljs-string">&quot;EN&quot;</span>,
      },
      <span class="hljs-attr">monthLabel</span>: {
        <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">nameMap</span>: <span class="hljs-title function_">checkIfChinese</span>() ? <span class="hljs-string">&quot;ZH&quot;</span> : <span class="hljs-string">&quot;EN&quot;</span>,
      },
      <span class="hljs-attr">yearLabel</span>: { <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span> },
    },
    <span class="hljs-attr">series</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;heatmap&quot;</span>,
      <span class="hljs-attr">coordinateSystem</span>: <span class="hljs-string">&quot;calendar&quot;</span>,
      <span class="hljs-attr">calendarIndex</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">data</span>: data,
    },
  });
};</code></pre></div>
<div class=" tc-reveal">

</div>
  <div style="text-align: right">
    
    
        
          <span class=" tc-reveal">
              <button class="tc-btn-invisible giscus-footer">
                
                <svg fill="" height="1em" stroke="" stroke-width="0" t="1569682881658" version="1.1" viewBox="0 0 1024 1024" width="1em" xmlns="http://www.w3.org/2000/svg"><defs></defs><path d="M573 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40zM293 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z"></path><path d="M894 345c-48.1-66-115.3-110.1-189-130v0.1c-17.1-19-36.4-36.5-58-52.1-163.7-119-393.5-82.7-513 81-96.3 133-92.2 311.9 6 439l0.8 132.6c0 3.2 0.5 6.4 1.5 9.4 5.3 16.9 23.3 26.2 40.1 20.9L309 806c33.5 11.9 68.1 18.7 102.5 20.6l-0.5 0.4c89.1 64.9 205.9 84.4 313 49l127.1 41.4c3.2 1 6.5 1.6 9.9 1.6 17.7 0 32-14.3 32-32V753c88.1-119.6 90.4-284.9 1-408zM323 735l-12-5-99 31-1-104-8-9c-84.6-103.2-90.2-251.9-11-361 96.4-132.2 281.2-161.4 413-66 132.2 96.1 161.5 280.6 66 412-80.1 109.9-223.5 150.5-348 102z m505-17l-8 10 1 104-98-33-12 5c-56 20.8-115.7 22.5-171 7l-0.2-0.1C613.7 788.2 680.7 742.2 729 676c76.4-105.3 88.8-237.6 44.4-350.4l0.6 0.4c23 16.5 44.1 37.1 62 62 72.6 99.6 68.5 235.2-8 330z"></path><path d="M433 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z"></path></svg>

                
                
                  Show Comments
                
                
                
              </button>
          </span>
          <span class=" tc-reveal" hidden="true"></span>
        
     
  </div>


<br>

</div></p>
</section>
</body>
</html>

