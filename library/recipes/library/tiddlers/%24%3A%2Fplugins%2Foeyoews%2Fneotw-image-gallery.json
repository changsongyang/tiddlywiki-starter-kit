{"title":"$:/plugins/oeyoews/neotw-image-gallery","description":"neotw-image-gallery","author":"oeyoews","version":"0.0.1","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"neotw-image-gallery","dependents":"$:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-image-gallery/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-image-gallery/readme\",\"text\":\"## usage\\n\\n```wikitext\\n<$gallery json=\\\"image-list.json\\\">\\n```\\n\\n<$gallery json=\\\"image-list.json\\\">\\n\\n## TODO\\n\\n<!-- * - [ ] 优化布局, tailwindcss or http://macyjs.com/ -->\\n\",\"type\":\"text/markdown\",\"description\":\"neotw-image-gallery\"},\"$:/plugins/oeyoews/neotw-image-gallery/createImage.js\":{\"title\":\"$:/plugins/oeyoews/neotw-image-gallery/createImage.js\",\"text\":\"/*\\\\\\r\\ntitle: $:/plugins/oeyoews/neotw-image-gallery/createImage.js\\r\\ntype: application/javascript\\r\\nmodule-type: library\\r\\n\\r\\n\\\\*/\\r\\n/** create image node */\\r\\nmodule.exports = function createImage(title, src) {\\r\\n  const options = {\\r\\n    root: null,\\r\\n    rootMargin: '0px',\\r\\n    threshold: 0.3, // 当图片50%进入可视区域时加载\\r\\n  };\\r\\n\\r\\n  const createElement = $tw.utils.domMaker;\\r\\n\\r\\n  function callback(entries, observer) {\\r\\n    entries.forEach((entry) => {\\r\\n      if (entry.isIntersecting) {\\r\\n        const image = entry.target;\\r\\n        image.src = src;\\r\\n        image.onload = () => {\\r\\n          img.alt = title;\\r\\n          image.classList.remove(...dynamicClassNames.split(' '));\\r\\n          img.classList.add('cursor-pointer');\\r\\n        };\\r\\n        observer.unobserve(image); // 加载后取消监测\\r\\n      }\\r\\n    });\\r\\n  }\\r\\n\\r\\n  const observer = new IntersectionObserver(callback, options);\\r\\n\\r\\n  const dynamicClassNames = 'scale-105 blur-md bg-black/10 cursor-wait';\\r\\n  const img = createElement('img', {\\r\\n    class: `object-cover w-full h-full spotlight rounded-md group-hover:scale-105 transition-all duration-800 ease-in-out shadow-md aspect-video ${dynamicClassNames}`,\\r\\n    attributes: {\\r\\n      src,\\r\\n      title,\\r\\n      loading: 'lazy',\\r\\n    },\\r\\n  });\\r\\n\\r\\n  observer.observe(img);\\r\\n\\r\\n  img.addEventListener('contextmenu', (e) => {\\r\\n    e.preventDefault();\\r\\n  });\\r\\n\\r\\n  return img;\\r\\n};\\r\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-image-gallery/widget.js\":{\"title\":\"$:/plugins/oeyoews/neotw-image-gallery/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-image-gallery/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nneotw-image-gallery widget\\n\\n\\\\*/\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\nconst createImage = require('./createImage');\\n\\nclass GalleryWidget extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n    this.jsonfile = null;\\n  }\\n\\n  render(parent, nextSibling) {\\n    this.parentDomNode = parent;\\n    this.computeAttributes();\\n    this.execute();\\n\\n    const createElement = $tw.utils.domMaker;\\n    const { json = 'image-list.json' } = this.attributes;\\n    this.jsonfile = json;\\n\\n    const data = $tw.wiki.getTiddlerData(json);\\n    const imagesURL = Object.entries(data);\\n\\n    const children = [];\\n\\n    imagesURL.forEach(([title, src]) => {\\n      children.push(createImage(title, src));\\n    });\\n\\n    const domNode = createElement('div', {\\n      class: 'grid grid-cols-1 md:grid-cols-3 gap-4',\\n      children,\\n    });\\n\\n    parent.insertBefore(domNode, nextSibling);\\n    this.domNodes.push(domNode);\\n  }\\n\\n  refresh(changedTiddlers) {\\n    if (Object.keys(changedTiddlers).includes(this.jsonfile)) {\\n      this.refreshSelf();\\n      return true;\\n    } else {\\n      return false;\\n    }\\n  }\\n}\\n\\n/**\\n * @description neotw-image-gallery widget\\n * @param {json}\\n */\\nexports.gallery = GalleryWidget;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}