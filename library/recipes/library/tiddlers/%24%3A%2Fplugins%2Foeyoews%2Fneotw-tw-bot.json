{"title":"$:/plugins/oeyoews/neotw-tw-bot","description":"快速记录下你的想法","author":"oeyoews","version":"0.0.1","core-version":">=5.3.0","type":"application/json","parent-plugin":"$:/plugins/oeyoews/neotw","plugin-type":"plugin","name":"Neotw Tw Bot","dependents":"$:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-tw-bot/Action\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/Action\",\"tags\":\"$:/tags/StartupAction/PostRender\",\"text\":\"<$list filter=\\\"[{$:/info/url/search}match[?layout=neotw-tw-bot]]\\\">\\n  <$action-setfield $tiddler=\\\"$:/layout\\\" text=\\\"$:/plugins/oeyoews/neotw-tw-bot/Layout\\\"/>\\n</$list>\"},\"$:/plugins/oeyoews/neotw-tw-bot/Layout\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/Layout\",\"tags\":\"$:/tags/Layout\",\"name\":\"{{$:/plugins/oeyoews/neotw-tw-bot/icon}}\",\"description\":\"{{$:/plugins/oeyoews/neotw-tw-bot/readme!!description}}\",\"text\":\"\\\\import [[$:/core/ui/PageMacros]] [all[shadows+tiddlers]tag[$:/tags/Macro]!has[draft.of]]\\n\\n<$vars\\n\\ttv-config-toolbar-icons={{$:/config/Toolbar/Icons}}\\n\\ttv-config-toolbar-text={{$:/config/Toolbar/Text}}\\n\\ttv-config-toolbar-class={{$:/config/Toolbar/ButtonClass}}\\n\\ttv-enable-drag-and-drop={{$:/config/DragAndDrop/Enable}}\\n\\ttv-show-missing-links={{$:/config/MissingLinks}}\\n\\tstoryviewTitle={{$:/view}}\\n\\tlanguageTitle={{{ [{$:/language}get[name]] }}}>\\n\\n<div class=\\\"prose max-w-none prose-indigo m-auto sm:w-auto md:w-2/3\\\">\\n  {{{ [[$:/plugins/oeyoews/neotw-tw-bot/readme]] ||$:/core/ui/ViewTemplate }}}\\n</div>\"},\"$:/plugins/oeyoews/neotw-tw-bot/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/readme\",\"description\":\"neotw-tw-bot\",\"text\":\"{{$:/languages/neotw-tw-bot/readme}}\\n\"},\"$:/plugins/oeyoews/neotw-tw-bot/icon\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/icon\",\"text\":\"<svg fill=\\\"none\\\" height=\\\"32\\\" viewBox=\\\"0 0 32 32\\\" width=\\\"32\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"m5 3.5c0 .65311-.4174 1.20873-1 1.41465v7.08535l2.16075 5.4867-2.16075 5.5133c-1.1 0-2-.8992-2-1.9982v-7.0036c0-.7357.40334-1.3819 1-1.7287v-7.35485c-.5826-.20592-1-.76154-1-1.41465 0-.82843.67157-1.5 1.5-1.5s1.5.67157 1.5 1.5z\\\" fill=\\\"#f8312f\\\"/><path d=\\\"m30.0499 3.55c0 .68107-.4392 1.25955-1.0499 1.46757v7.18223c.5967.3471 1 .9939 1 1.7303v7.01c0 1.1-.9 2-2 2l-2.9405-5.6792 2.9405-5.3308v-6.9125c-.6107-.20799-1.05-.78649-1.05-1.4676 0-.85604.6939-1.55 1.55-1.55.856 0 1.5499.69396 1.5499 1.55z\\\" fill=\\\"#f8312f\\\"/><path d=\\\"m11 4.5c0-.82843.6716-1.5 1.5-1.5h7c.8284 0 1.5.67157 1.5 1.5 0 .67932-.4516 1.25317-1.0709 1.43774-.2765.08238-.5696.10387-.8462.18581l-3.053.90437-3.1191-.90828c-.2725-.07936-.5607-.10013-.8331-.1799-.6228-.18238-1.0777-.75794-1.0777-1.43974z\\\" fill=\\\"#ffb02e\\\"/><path d=\\\"m22.05 30h-12.1c-3.29 0-5.95-2.66-5.95-5.95v-12.02c0-3.33 2.7-6.03 6.03-6.03h11.95c3.32 0 6.02 2.7 6.02 6.03v12.03c0 3.28-2.66 5.94-5.95 5.94z\\\" fill=\\\"#cdc4d6\\\"/><path d=\\\"m9.24738 18.5h13.50522c2.3296 0 4.2474-1.919 4.2474-4.25 0-2.341-1.9078-4.25-4.2474-4.25h-13.50522c-2.33958 0-4.24738 1.909-4.24738 4.25s1.9078 4.25 4.24738 4.25z\\\" fill=\\\"#212121\\\"/><path d=\\\"m13.4718 26h5.0564c.811 0 1.4718-.6735 1.4718-1.5s-.6608-1.5-1.4718-1.5h-5.0564c-.811 0-1.4718.6735-1.4718 1.5s.6608 1.5 1.4718 1.5z\\\" fill=\\\"#212121\\\"/><g fill=\\\"#00a6ed\\\"><path d=\\\"m10.25 12c-.69036 0-1.25.5596-1.25 1.25v2.5c0 .6904.55964 1.25 1.25 1.25.6904 0 1.25-.5596 1.25-1.25v-2.5c0-.6904-.5596-1.25-1.25-1.25z\\\"/><path d=\\\"m21.75 12c-.6904 0-1.25.5596-1.25 1.25v2.5c0 .6904.5596 1.25 1.25 1.25s1.25-.5596 1.25-1.25v-2.5c0-.6904-.5596-1.25-1.25-1.25z\\\"/></g></svg>\",\"type\":\"image/svg+xml\"},\"$:/languages/neotw-tw-bot/readme\":{\"title\":\"$:/languages/neotw-tw-bot/readme\",\"text\":\"<div class=\\\"prose max-w-none prose-indigo\\\">\\n\\n* [[Source|https://github.com/oeyoews/neotw/tree/main/plugins/oeyoews/neotw-tw-bot]]\\n\\n!! Usage\\n\\n```\\n<$tw-bot />\\n```\\n\\n* 所有tiddlers都是由creator: tw-bot创建, 可以使用筛选器选择比如 [creator[tw-bot]] 查找tw-bot创建的所有tiddlers\\n\\n<$tw-bot />\\n\\n!! 依赖插件\\n\\n* tailwindcss: 样式依赖\\n* swal2: 通知依赖\\n\\n!! TODO\\n\\n* 想法条目的自动检索\\n* 自定义option组件\\n\\n---\\n\\n<$button class=\\\"bg-rose-400 p-2 rounded\\\">\\n  delete tw-bot created tiddlers\\n  <$action-deletetiddler $filter=\\\"[prefix[tw-bot/messages/]creator[tw-bot]]\\\"/>\\n</$button>\\n\\n</div>\"},\"$:/plugins/oeyoews/neotw-tw-bot/send.svg\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/send.svg\",\"text\":\"<svg class=\\\"fill-gray-300\\\" stroke=\\\"currentColor\\\" fill=\\\"currentColor\\\" stroke-width=\\\"0\\\" t=\\\"1569683742680\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" height=\\\"1em\\\" width=\\\"1em\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><defs></defs><path d=\\\"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2-8.5 2.1-13.8 10.7-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-0.9 3.7-0.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 0.7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-0.8 4.2-2.6 5-5 1.4-4.2-0.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z\\\"></path></svg>\\n\",\"type\":\"image/svg+xml\"},\"$:/plugins/oeyoews/neotw-tw-bot/sendmessage.js\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/sendmessage.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-tw-bot/sendmessage.js\\ntype: application/javascript\\nmodule-type: library\\n\\n// 配置UI\\n// line color\\n\\n\\\\*/\\nmodule.exports = function twBot() {\\n  const tags = [\\\"想法\\\", \\\"任务\\\", \\\"工作\\\", \\\"生活\\\", \\\"其他\\\"];\\n  const selectedTag = localStorage.getItem(\\\"selectedTag\\\");\\n  const defaultTag = selectedTag || tags[0]; // 如果localStorage中没有存储标签，则使用第一个标签作为默认标签\\n  const selectTag = document.createElement(\\\"select\\\");\\n  selectTag.classList.add(\\\"appearance-none\\\", \\\"border-none\\\", \\\"p-2\\\", \\\"rounded\\\");\\n  tags.forEach((tag) => {\\n    const option = document.createElement(\\\"option\\\");\\n    option.value = tag;\\n    option.text = tag;\\n    if (tag === defaultTag) {\\n      option.selected = true; // 设置默认选中标签\\n    }\\n    selectTag.appendChild(option);\\n  });\\n\\n  // 直接使用fakeDocument会报错\\n  const form = document.createElement(\\\"form\\\");\\n  form.classList.add(\\n    \\\"p-2\\\",\\n    \\\"flex\\\",\\n    \\\"justify-between\\\",\\n    \\\"max-w-xl\\\",\\n    \\\"mx-auto\\\",\\n    \\\"border\\\",\\n    \\\"border-2\\\",\\n    \\\"rounded\\\"\\n  );\\n\\n  const button = document.createElement(\\\"button\\\");\\n\\n  const sendIcon = $tw.wiki.getTiddlerText(\\n    \\\"$:/plugins/oeyoews/neotw-tw-bot/send.svg\\\"\\n  );\\n  button.innerHTML = sendIcon;\\n  button.classList.add(\\n    \\\"p-2\\\",\\n    \\\"mx-2\\\",\\n    \\\"bg-transparent\\\",\\n    \\\"hover:fill-green-700\\\",\\n    \\\"scale-125\\\",\\n    \\\"cursor-not-allowed\\\"\\n  );\\n  button.title = \\\"send\\\";\\n  button.disabled = true; // 不需要使用readonly\\n  const inputMessage = document.createElement(\\\"input\\\");\\n  inputMessage.classList.add(\\n    \\\"w-full\\\",\\n    \\\"mx-2\\\",\\n    \\\"border-none\\\",\\n    \\\"placeholder-gray-300\\\",\\n    \\\"caret-indigo-500\\\"\\n  );\\n  inputMessage.placeholder = `任何${tags} ...`;\\n  inputMessage.addEventListener(\\\"input\\\", function () {\\n    // 检查输入框的值是否为空，然后设置按钮的禁用状态\\n    button.disabled = !inputMessage.value;\\n    if (button.disabled) {\\n      button.classList.add(\\\"cursor-not-allowed\\\");\\n    } else {\\n      button.classList.remove(\\\"cursor-not-allowed\\\");\\n    }\\n  });\\n  form.appendChild(selectTag);\\n  form.appendChild(inputMessage);\\n  form.appendChild(button);\\n\\n  form.addEventListener(\\\"submit\\\", (e) => {\\n    e.preventDefault();\\n    sentMessage(selectTag.value);\\n  });\\n\\n  const timestamp = new Date().toISOString().replace(/\\\\D/g, \\\"\\\");\\n\\n  const options = {\\n    created: timestamp,\\n    modified: timestamp,\\n    creator: \\\"tw-bot\\\",\\n  };\\n\\n  function sentMessage(selectedTag) {\\n    const tags = selectedTag;\\n    localStorage.setItem(\\\"selectedTag\\\", selectedTag);\\n    // create new tiddler\\n    $tw.wiki.addTiddler({\\n      title: `tw-bot/messages/${timestamp}`,\\n      text: inputMessage.value,\\n      tags,\\n      ...options,\\n    });\\n    // 需要await\\n    // inputMessage.value = \\\"\\\";\\n    // 统计当天记录的想法数量\\n    const count = $tw.wiki.filterTiddlers(`[tag[${tags}]days[-1]]`).length;\\n    Swal.fire({\\n      icon: \\\"success\\\",\\n      title: `这是你今天的第 ${count} 条${tags}`,\\n      showConfirmButton: false,\\n      timer: 1500,\\n      toast: true,\\n      position: \\\"top-end\\\",\\n    });\\n  }\\n  return form;\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-tw-bot/widget.js\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-tw-bot/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nneotw-tw-bot widget\\n\\n\\\\*/\\n(function () {\\n  /*jslint node: true, browser: true */\\n  /*global $tw: false */\\n  \\\"use strict\\\";\\n  // 是$:/plugins/oeyoews/neotw-tw-bot/sendmessage.js 的简写, 和真实文件路径无关, 但最好相同, 方便编辑器识别, 就不用写.js 后缀\\n  const twBot = require(\\\"./sendmessage\\\");\\n\\n  const Widget = require(\\\"$:/core/modules/widgets/widget.js\\\").widget;\\n\\n  class TwBot extends Widget {\\n    constructor(parseTreeNode, options) {\\n      super(parseTreeNode, options);\\n      this.virtualRoot = null;\\n    }\\n\\n    render(parent, nextSibling) {\\n      if (!$tw.browser) return;\\n      this.virtualRoot = twBot();\\n\\n      this.parentDomNode = parent;\\n      this.computeAttributes();\\n      this.execute();\\n\\n      parent.insertBefore(this.virtualRoot, nextSibling);\\n      this.domNodes.push(this.virtualRoot);\\n    }\\n\\n    refresh() {\\n      this.refreshSelf();\\n    }\\n  }\\n\\n  exports[\\\"tw-bot\\\"] = TwBot;\\n})();\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}