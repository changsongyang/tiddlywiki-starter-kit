{"title":"$:/plugins/oeyoews/hitokoto","description":"hitokoto","author":"oeyoews","version":"0.0.1","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"hitokoto","meat#disabled":"yes","dependents":"$:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/hitokoto/readme\":{\"title\":\"$:/plugins/oeyoews/hitokoto/readme\",\"text\":\"<!-- plugin template readme -->\\n\",\"type\":\"text/markdown\",\"description\":\"hitokoto\"},\"$:/plugins/oeyoews/hitokoto/widget.js\":{\"title\":\"$:/plugins/oeyoews/hitokoto/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/hitokoto/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nhitokoto widget\\n\\n\\\\*/\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\nconst MarkdownIt = require('$:/plugins/tiddlywiki/markdown/markdown-it');\\n\\nclass HitokotoWidget extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n  }\\n\\n  render(parent, nextSibling) {\\n    this.parentDomNode = parent;\\n    this.computeAttributes();\\n    this.execute();\\n\\n    const createElement = $tw.utils.domMaker;\\n    // getall journal tiddler\\n    const journalTiddlers = $tw.wiki.filterTiddlers(\\n      '[tag[Journal]!sort[created]]',\\n    );\\n\\n    const children = [];\\n    function parseAsBoolean(tiddlerName) {\\n      return (\\n        $tw.wiki.getTiddlerText(tiddlerName, 'false').trim().toLowerCase() ===\\n        'true'\\n      );\\n    }\\n\\n    const md = new MarkdownIt({\\n      html: true,\\n      xhtmlOut: true,\\n      breaks: parseAsBoolean('$:/config/markdown/breaks'),\\n      quotes: $tw.wiki.getTiddlerText('$:/config/markdown/quotes').trim(),\\n      typographer: parseAsBoolean('$:/config/markdown/typographer'),\\n      linkify: parseAsBoolean('$:/config/markdown/linkify'),\\n    });\\n\\n    md.use(require('$:/plugins/cdr/markdown-more/markdown-it-checklist.js'))\\n      // bug\\n      // .use(require('$:/plugins/tiddlywiki/markdown/markdown-it-tiddlywiki.js'))\\n      .use(require('$:/plugins/cdr/markdown-more/markdown-it-admonition'));\\n\\n    function getRandomColor(colors) {\\n      const randomIndex = Math.floor(Math.random() * colors.length);\\n      return colors[randomIndex];\\n    }\\n\\n    const colors = [\\n      'slate',\\n      'gray',\\n      'zinc',\\n      'neutral',\\n      'stone',\\n      'red',\\n      'orange',\\n      'amber',\\n      'yellow',\\n      'lime',\\n      'green',\\n      'emerald',\\n      'teal',\\n      'cyan',\\n      'sky blue',\\n      'indigo',\\n      'violet',\\n      'purple',\\n      'fuchsia',\\n      'pink',\\n      'rose',\\n    ];\\n\\n    journalTiddlers.map((tiddler) => {\\n      const color = getRandomColor(colors);\\n      const { text, created, creator, type, title } =\\n        $tw.wiki.getTiddler(tiddler).fields;\\n      let content;\\n      if (type == 'text/markdown') {\\n        content = md.render(text);\\n      } else {\\n        // https://github.com/Jermolene/TiddlyWiki5/pull/7413\\n        content = $tw.wiki.renderText('text/html', 'text/vnd.tiddlywiki', text);\\n      }\\n      const link = `[[${title}]]`;\\n      content += $tw.wiki.renderText('text/html', 'text/vnd.tiddlywiki', link);\\n      const htNode = this.document.createElement('blockquote');\\n      htNode.className = `my-4 bg-${color}-200 p-2 rounded border-l-[3px] border-l-${color}-300`;\\n      htNode.innerHTML = content;\\n      children.push(htNode);\\n    });\\n\\n    const domNode = createElement('div', {\\n      children,\\n    });\\n\\n    parent.insertBefore(domNode, nextSibling);\\n    this.domNodes.push(domNode);\\n  }\\n}\\n\\n/**\\n * @description hitokoto widget\\n * @param text\\n */\\nexports.ht = HitokotoWidget;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}