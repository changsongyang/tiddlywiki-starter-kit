{"title":"$:/plugins/oeyoews/neotw-time","description":"Neotw Time","author":"oeyoews","version":"0.0.1","core-version":">=5.2.5","type":"application/json","plugin-type":"plugin","name":"Neotw Time","dependents":"$:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","list":"readme explore","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-time/Layout\":{\"title\":\"$:/plugins/oeyoews/neotw-time/Layout\",\"tags\":\"$:/tags/Layout\",\"name\":\"{{$:/plugins/oeyoews/neotw-time/icon}} Neotw Time\",\"description\":\"{{$:/plugins/oeyoews/neotw-time/readme!!description}}\",\"text\":\"<div class=\\\"prose max-w-none prose-indigo m-auto w-1/2 my-4\\\">\\n  <$transclude tiddler=\\\"$:/plugins/oeyoews/neotw-time/readme\\\" />\\n</div>\\n\"},\"$:/plugins/oeyoews/neotw-time/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-time/readme\",\"description\":\"Neotw Time\",\"text\":\"<div class=\\\"prose max-w-none prose-indigo\\\">\\n\\n!! Neotw Time\\n\\n* [[Source|https://github.com/oeyoews/neotw/tree/main/plugins/oeyoews/neotw-time]]\\n* [[Demo|https://oeyoews.github.io/neotw]]\\n\\n!! Examples\\n\\n```\\n<$ostage />\\n<$ostage timestamp='2023-6-1'/>\\n<$ostage timestamp='2022-01-01'/>\\n```\\n\\n<$ostage />\\n\\n<$ostage timestamp='2023-6-1'/>\\n\\n<$ostage timestamp='2022-01-01'/>\\n\\n</div>\\n\"},\"$:/plugins/oeyoews/neotw-otime/stage.js\":{\"title\":\"$:/plugins/oeyoews/neotw-otime/stage.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-otime/stage.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nstage widget\\n\\n\\\\*/\\n(function () {\\n  /*jslint node: true, browser: true */\\n  /*global $tw: false */\\n  'use strict';\\n\\n  if (!$tw.browser) return;\\n\\n  const Widget = require('$:/core/modules/widgets/widget.js').widget;\\n  const { calculateTimeDiff } = require('./time');\\n\\n  class StageWidget extends Widget {\\n    constructor(parseTreeNode, options) {\\n      super(parseTreeNode, options);\\n      this.timestamp = null; // 初始设为 null\\n      this.interval = null; // 初始设为 null\\n    }\\n\\n    computeAttributes() {\\n      super.computeAttributes();\\n      this.timestamp = this.getAttribute('timestamp', '2021-12-23');\\n      this.interval = this.getAttribute('interval', 1000);\\n    }\\n\\n    startTimer() {\\n      this.update();\\n      this.timer = setInterval(() => {\\n        this.update();\\n      }, this.interval);\\n    }\\n\\n    update() {\\n      if (!this.domNodes || !this.domNodes[0]) {\\n        clearInterval(this.timer);\\n        return;\\n      }\\n      this.domNodes[0].textContent = calculateTimeDiff(this.timestamp);\\n    }\\n\\n    render(parent, nextSibling) {\\n      this.parentDomNode = parent;\\n      this.computeAttributes();\\n      this.execute();\\n\\n      const gradient = this.hasAttribute('gradient');\\n      const StageNode = $tw.utils.domMaker('div', {\\n        class: 'my-2',\\n        text: calculateTimeDiff(this.timestamp),\\n      });\\n\\n      gradient &&\\n        StageNode.classList.add(\\n          'text-transparent',\\n          'bg-clip-text',\\n          'bg-gradient-to-r',\\n          'from-cyan-400',\\n          'to-purple-400',\\n          'inline',\\n        );\\n\\n      parent.insertBefore(StageNode, nextSibling);\\n      this.domNodes.push(StageNode);\\n\\n      this.startTimer();\\n    }\\n  }\\n\\n  exports['ostage'] = StageWidget;\\n})();\",\"type\":\"application/javascript\",\"module-type\":\"widget\"},\"$:/plugins/oeyoews/neotw-otime/time.js\":{\"title\":\"$:/plugins/oeyoews/neotw-otime/time.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-otime/time.js\\ntype: application/javascript\\nmodule-type: library\\n\\ntime.js\\n\\n\\\\*/\\nfunction calculateTimeDiff(pastDateString) {\\n  const pastDate = new Date(pastDateString);\\n  const currentDate = new Date();\\n\\n  // 验证过去日期是否有效\\n  if (pastDate > currentDate) {\\n    console.error('过去日期无效，不能超过当前时间！');\\n    return;\\n  }\\n\\n  const timeDiff = currentDate.getTime() - pastDate.getTime();\\n\\n  const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));\\n  const hours = Math.floor(\\n    (timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60),\\n  );\\n  const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));\\n  const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);\\n\\n  // console.clear(); ???\\n\\n  const timeStage = `距离 ${pastDate.toLocaleDateString()} 已经过去了 ${days} 天 ${hours} 小时 ${minutes} 分钟 ${seconds} 秒。`;\\n  return timeStage;\\n}\\n\\nmodule.exports = {\\n  calculateTimeDiff,\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-time/widget.js\":{\"title\":\"$:/plugins/oeyoews/neotw-time/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-time/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nneotw-time widget\\n\\n\\\\*/\\n(function () {\\n  /*jslint node: true, browser: true */\\n  /*global $tw: false */\\n  'use strict';\\n\\n  if (!$tw.browser) return;\\n\\n  const Widget = require('$:/core/modules/widgets/widget.js').widget;\\n\\n  class TimeWidget extends Widget {\\n    constructor(parseTreeNode, options) {\\n      super(parseTreeNode, options);\\n      this.interval = this.getAttribute('interval', 1000);\\n    }\\n\\n    render(parent, nextSibling) {\\n      this.parentDomNode = parent;\\n      this.computeAttributes();\\n      this.execute();\\n\\n      const classNames = this.getAttribute('class', '').split(' ');\\n\\n      const divNode = $tw.utils.domMaker('div', {\\n        class: classNames.join(' '),\\n      });\\n\\n      parent.insertBefore(divNode, nextSibling);\\n      this.domNodes.push(divNode);\\n\\n      this.startTimer();\\n    }\\n\\n    startTimer() {\\n      this.update();\\n      this.timer = setInterval(() => {\\n        this.update();\\n      }, this.interval);\\n    }\\n\\n    update() {\\n      if (!this.domNodes || !this.domNodes[0]) {\\n        clearInterval(this.timer);\\n        return;\\n      }\\n\\n      const now = new Date();\\n      const timeString = now.toLocaleTimeString();\\n      this.domNodes[0].textContent = timeString;\\n    }\\n  }\\n\\n  exports['otime'] = TimeWidget;\\n})();\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}